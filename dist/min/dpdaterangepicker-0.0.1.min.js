/* 
*  Name: dpdaterangepicker 
*  Description: Date range picker - AngularJS reusable UI component 
*  Version: 0.0.1 
*  Author: kekeh 
*  Homepage: http://kekeh.github.io/dpdaterangepicker 
*  License: MIT 
*  Date: 2015-07-14 
*/ 
angular.module('template-dpdaterangepicker-0.0.1.html', ['templates/dpdaterangepicker.html']);

angular.module("templates/dpdaterangepicker.html", []).run(["$templateCache", function($templateCache) {
  $templateCache.put("templates/dpdaterangepicker.html",
    "<div class=\"dpdaterangepicker\">\n" +
    "    <div class=\"dpselectiongroup\">\n" +
    "        <span class=\"dpselection\" ng-style=\"{'line-height': elemHeight + 'px'}\" ng-click=\"picker()\">{{selectedRangeTxt}}</span>\n" +
    "        <span class=\"dpselbtngroup\" ng-style=\"{'height': elemHeight + 'px'}\">\n" +
    "            <button class=\"dpbtnclear\" ng-show=\"selectedRangeTxt.length > 0\" ng-click=\"selectedRangeTxt='';selectedDate={day:0,month:0,year:0}\">\n" +
    "                <span class=\"icon icon-cross\"></span>\n" +
    "            </button>\n" +
    "            <button class=\"dpbtnpicker\" ng-click=\"picker()\">\n" +
    "                <span class=\"icon icon-calendar\"></span>\n" +
    "            </button>\n" +
    "        </span>\n" +
    "    </div>\n" +
    "\n" +
    "    <div class=\"dpselector\" ng-if=\"showSelector\">\n" +
    "\n" +
    "        <div class=\"dptitlearea\" ng-class=\"{'dptitlerangeok': rangeOk, 'dptitlerangenotok': !rangeOk}\">\n" +
    "            <div class=\"dptitleareatxt\">{{titleTxt}}</div>\n" +
    "        </div>\n" +
    "\n" +
    "        <table class=\"dpheader\">                  \n" +
    "            <tr> \n" +
    "                <td>\n" +
    "                    <div style=\"float:left\">\n" +
    "                        <div class=\"dpheaderbtn\" ng-click=\"prevMonth()\"><span class=\"icon icon-left\"></span></div>\n" +
    "                        <div class=\"dpheadermonthtxt\" ng-bind=\"visibleMonth.monthTxt\"></div>\n" +
    "                        <div class=\"dpheaderbtn\" ng-click=\"nextMonth()\"><span class=\"icon icon-right\"></span></div>\n" +
    "                    </div>\n" +
    "                </td>\n" +
    "                <td>\n" +
    "                    <button class=\"dpheadertodaybtn\" ng-click=\"today()\">{{options.buttons.todayBtnText}}</button>\n" +
    "                </td>\n" +
    "                <td>\n" +
    "                    <div style=\"float:right\">\n" +
    "                        <div class=\"dpheaderbtn\" ng-click=\"prevYear()\"><span class=\"icon icon-left\"></span></div>\n" +
    "                        <div class=\"dpheaderyeartxt\" ng-bind=\"visibleMonth.year\"></div>\n" +
    "                        <div class=\"dpheaderbtn\" ng-click=\"nextYear()\"><span class=\"icon icon-right\"></span></div>\n" +
    "                    </div>\n" +
    "                </td>\n" +
    "            </tr>\n" +
    "        </table>     \n" +
    "\n" +
    "        <table class=\"dptable\">                  \n" +
    "            <thead><tr><th ng-repeat=\"d in weekDays track by $index\" ng-bind=\"d\"></th></tr></thead>\n" +
    "            <tbody>\n" +
    "                <tr ng-repeat=\"w in dates track by $index\">\n" +
    "                    <td ng-repeat=\"d in w track by $index\" \n" +
    "                        ng-class=\"{'dpcurrmonth':d.cmo===config.CURR_MONTH, \n" +
    "                                   'dpcurrday':d.currDay,\n" +
    "                                   'dpselectedday':selectedDate.day===d.day && selectedDate.month===d.month && selectedDate.year===d.year && d.cmo===config.CURR_MONTH}\"\n" +
    "                        ng-click=\"cellClicked(d)\">\n" +
    "                        <span style=\"background-color:inherit\" \n" +
    "                              ng-class=\"{'dpprevmonth':d.cmo===config.PREV_MONTH,'dpcurrmonth':d.cmo===config.CURR_MONTH,'dpnextmonth':d.cmo===config.NEXT_MONTH,\n" +
    "                                         'dpsunday':d.sun && d.cmo===config.CURR_MONTH && options.sundayRedColor}\" ng-bind=\"d.day\"></span>\n" +
    "                    </td>\n" +
    "                </tr>\n" +
    "            </tbody>\n" +
    "        </table>\n" +
    "\n" +
    "        <div class=\"dpfooterarea\">\n" +
    "            <button class=\"dpfooterbtn\" ng-class=\"{'dpbtndisable': !rangeOk}\" ng-disabled=\"!rangeOk\" ng-show=\"beginDateStep\" ng-click=\"toEndDate()\">\n" +
    "                {{options.buttons.nextBtnText}}\n" +
    "            </button>\n" +
    "            <button class=\"dpfooterbtn\" ng-show=\"!beginDateStep\" ng-click=\"toBeginDate()\">\n" +
    "                {{options.buttons.prevBtnText}}\n" +
    "            </button>\n" +
    "            <button class=\"dpfooterbtn\" ng-class=\"{'dpbtndisable': !rangeOk}\" ng-disabled=\"!rangeOk\" ng-show=\"!beginDateStep\" ng-click=\"accept()\">\n" +
    "                {{options.buttons.okBtnText}}\n" +
    "            </button>\n" +
    "        </div>\n" +
    "\n" +
    "    </div>\n" +
    "</div> \n" +
    "");
}]);

angular.module("dpdaterangepicker",["template-dpdaterangepicker-0.0.1.html"]).constant("dpdaterangeConfig",{YEAR_CONST:"yyyy",MONTH_CONST:"mm",DATE_CONST:"dd",PREV_MONTH:1,CURR_MONTH:2,NEXT_MONTH:3,DATES_SEPARATOR:" - "}).directive("dpdaterangepicker",["$timeout","$document",function(a,b){return{restrict:"EA",templateUrl:"templates/dpdaterangepicker.html",scope:{options:"="},controller:["$scope","dpdaterangeConfig",function(a,b){a.config=b}],link:function(c,d,e){function f(a,b){c.selectedDate={day:0,month:0,year:0},c.titleTxt=a,c.beginDateStep=b,c.rangeOk=!1}function g(a){if(c.selectedDate={day:a.day,month:a.month,year:a.year},c.beginDateStep)c.rangeOk=!0,c.titleTxt=h(a),r=angular.copy(c.selectedDate);else{var b=new Date(r.year,r.month-1,r.day),d=new Date(c.selectedDate.year,c.selectedDate.month-1,c.selectedDate.day);c.rangeOk=d>=b,c.titleTxt=h(r)+c.config.DATES_SEPARATOR+h(a)}}function h(a){var b=angular.copy(c.options.dateFormat);return b.replace(c.config.YEAR_CONST,a.year).replace(c.config.MONTH_CONST,i(a.month)).replace(c.config.DATE_CONST,i(a.day))}function i(a){return 10>a?"0"+a:a}function j(a){return c.options.monthLabels[a]}function k(a,b){var c=new Date;return c.setDate(1),c.setMonth(b-1),c.setYear(a),c.getDay()}function l(a,b){return new Date(b,a,0).getDate()}function m(a,b){return 1===a?(a=12,b--):a--,l(a,b)}function n(a,b,c,d){return a===s.getDate()&&b===s.getMonth()+1&&c===s.getFullYear()&&2===d}function o(a,b){c.dates.length=0;for(var d=k(b,a),e=l(a,b),f=m(a,b),g=1,h=c.config.PREV_MONTH,i=1;7>i;i++){var j=[];if(1===i){for(var o=f-d+1,p=o;f>=p;p++)j.push({day:p,month:a,year:b,cmo:h,currDay:n(p,a,b,h),sun:0===j.length});h=c.config.CURR_MONTH;for(var q=7-j.length,p=0;q>p;p++)j.push({day:g,month:a,year:b,cmo:h,currDay:n(g,a,b,h),sun:0===j.length}),g++}else for(var p=1;8>p;p++)g>e&&(g=1,h=c.config.NEXT_MONTH),j.push({day:g,month:a,year:b,cmo:h,currDay:n(g,a,b,h),sun:0===j.length}),g++;c.dates.push(j)}}function p(a){d[0].contains(a.target)||1!==a.which||(c.showSelector&&(c.showSelector=!1),c.$apply())}function q(){c.elemHeight=d.children().prop("offsetHeight")-2;var a=["su","mo","tu","we","th","fr","sa"];for(var e in a)c.weekDays.push(c.options.dayLabels[a[e]]);void 0!==c.options.initSelectedDateRange&&(c.selectedRangeTxt=h(c.options.initSelectedDateRange.begin)+c.config.DATES_SEPARATOR+h(c.options.initSelectedDateRange.end)),b.on("click",p)}c.dates=[],c.weekDays=[],c.selectedRangeTxt="",c.titleTxt="",c.showSelector=!1,c.rangeOk=!1,c.beginDateStep=!0,c.selectedDate={day:0,month:0,year:0},c.visibleMonth={monthTxt:"",monthNbr:0,year:0};var r={day:0,month:0,year:0},s=new Date;c.prevMonth=function(){var a=c.visibleMonth.monthNbr,b=c.visibleMonth.year;1===a?(a=12,b--):a--,c.visibleMonth={monthTxt:j(a),monthNbr:a,year:b}},c.nextMonth=function(){var a=c.visibleMonth.monthNbr,b=c.visibleMonth.year;12===a?(a=1,b++):a++,c.visibleMonth={monthTxt:j(a),monthNbr:a,year:b}},c.prevYear=function(){c.visibleMonth.year--},c.nextYear=function(){c.visibleMonth.year++},c.today=function(){var a=s.getMonth()+1;c.visibleMonth={monthTxt:j(a),monthNbr:a,year:s.getFullYear()}},c.cellClicked=function(a){a.cmo===c.config.PREV_MONTH?c.prevMonth():a.cmo===c.config.CURR_MONTH?g(a):a.cmo===c.config.NEXT_MONTH&&c.nextMonth()},c.toBeginDate=function(){c.selectedDate=r,c.titleTxt=h(r),c.beginDateStep=!0,c.rangeOk=!0},c.toEndDate=function(){f(h(r)+c.config.DATES_SEPARATOR+c.options.endDateText,!1)},c.accept=function(){c.selectedRangeTxt=c.titleTxt,c.showSelector=!1,c.options.dateRangeSelectCb&&c.options.dateRangeSelectCb({day:r.day,month:r.month,year:r.year,formatted:h(r)},{day:c.selectedDate.day,month:c.selectedDate.month,year:c.selectedDate.year,formatted:h(c.selectedDate)},c.selectedRangeTxt)},c.picker=function(){if(c.showSelector=!c.showSelector,c.showSelector){f(c.options.beginDateText,!0);var a=0,b=0;void 0===c.options.initSelectorMonth?(a=s.getFullYear(),b=s.getMonth()+1):(a=c.options.initSelectorMonth.year,b=c.options.initSelectorMonth.month),c.visibleMonth={monthTxt:c.options.monthLabels[b],monthNbr:b,year:a},o(b,a)}},c.$watch("visibleMonth",function(a,b){a!==b&&o(a.monthNbr,a.year)},!0),c.$on("$destroy",function(){b.off("click",p)}),a(q)}}}]);